<!-- Content Header (Page header) -->
<section class="content-header">
	<h1>
		订单管理<small>Order Management</small>
	</h1>
	<ol class="breadcrumb">
		<li><a href="${basePath}/main"><i class="fa fa-dashboard"></i> 首页</a></li>
		<li class="active">订单管理</li>
	</ol>
</section>

<!-- Main content -->
<section class="content">
		<div class="box box-primary">
	        <form id="order-search-form" action="" class="form-horizontal" method="post">
	        <div class="box-body">
	          	<div class="col-sm-4">
					<div class="form-group">
						<label class="col-sm-4 control-label">购物车id</label>
						<div class="col-sm-8">
						<input id="search-shoppingId" name="search-shoppingId" type="text" class="form-control"
								placeholder="请输入购物车id" maxlength="11">
							
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">订单状态</label>
						<div class="col-sm-8">
							<select name="search-orderStatus" id="search-orderStatus" class="form-control">
								<option value="">请选择...</option>
								<option value="0">已提交</option>
								<option value="1">已支付</option>
								<option value="2">已验收</option>
								<option value="3">已发货</option>
								<option value="4">已收货</option>
							</select>
						</div>
					</div>
				</div>
				
	        </div>
	        </form>
	        
	        <!-- /.box-body -->
	        <div class="box-footer">
	        	<div class="row">
	          	<div id="toolbar" class="btn-toolbar">
					<div class="btn-group pull-left">
<!--  						<button type="button" data-btn-type="add" class="btn btn-success"><i class="fa fa-plus"></i>新增</button>
 --> 						<button type="button" data-btn-type="scan" class="btn btn-info"><i class="fa fa-search-plus"></i>查看</button>
<!-- 						<button type="button" data-btn-type="edit" class="btn btn-warning"><i class="fa fa-edit"></i>修改</button>
 -->						<button type="button" data-btn-type="delete" class="btn btn-danger"><i class="fa fa-remove"></i>删除</button>
					</div>

					<!-- <div class="btn-group pull-left">
						<button type="button" data-btn-type="enable" class="btn btn-success"><i class="fa fa-check-circle-o"></i>启用</button>
						<button type="button" data-btn-type="disable" class="btn btn-danger"><i class="fa fa-ban"></i>禁用</button>
					</div> -->					
					<div class="btn-group pull-right">
						<button type="button" data-btn-type="search" class="btn btn-primary"><i class="fa fa-search"></i>查询</button>
						<button type="button" data-btn-type="reset" class="btn btn-default"><i class="fa fa-reply"></i>重置</button>
					</div>
				</div>
				</div>
				<div class="row">
					<table id="order-table" data-toggle="table" data-url="shopping/orderList" data-toolbar="#toolbar" data-pagination="true" data-search="false"
						data-striped="true" data-show-export="true" data-page-size="10" data-click-to-select="true">
						<thead>
							<tr>
								<th data-checkbox="true" class="select-checkbox"></th>
<!-- 								<th data-align="center" data-field="id" data-sortable="true">利率ID</th>
 -->							<th data-align="center" data-field="shoppingId" data-sortable="true" >购物车Id</th>
								<th data-align="center" data-field="orderStatus" data-sortable="true" data-formatter="orderStatusFormatter">订单状态</th>
								<th data-align="center" data-field="adress" data-sortable="true">收货地址</th>
								<th data-align="center" data-field="createtime" data-sortable="true" data-formatter="formatteryyyyMMddHHmmss">注册时间</th>
								
							</tr>
						</thead>
					</table>
				</div>
	        </div>
	        <!-- /.box-footer-->
      </div>
</section>

<!-- 编辑菜单的弹窗 -->
<div class="modal fade" id="model-order" aria-labelledby="modalOrderLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form class="form-horizontal" action="" id="order-form" method="post">
				<input type="hidden" id="flag" name="flag">
				<input type="hidden" id="id" name="id">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">×</button>
					<h4 class="modal-title" id="modalOrderLabel"></h4>
				</div>
				<div class="modal-body">
				<div class="form-group">
						<label class="col-sm-4 control-label">购物车id<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="shoppingId" name="shoppingId" type="text" class="form-control"
								 maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">订单状态<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<select name="orderStatus" id="orderStatus" class="form-control">
								<option value="">请选择...</option>
								<option value="0">已提交</option>
								<option value="1">已支付</option>
								<option value="2">已验收</option>
								<option value="3">已发货</option>
								<option value="4">已收货</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">收货地址<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="adress" name="adress" type="text" class="form-control"
								 maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">创建时间<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="createtime" name="createtime" type="text" class="form-control"
								 maxlength="11">
						</div>
					</div>
					</div>
					<div class="modal-footer">
						<button type="submit" class="btn btn-success" id="saveBtn"><i class="fa fa-save"></i>保存</button>
						<button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i>关闭</button>
					</div>
				</div>
				
			</form>
		</div>
	</div>
</div>
<script src="${basePath}/assets/adminlte/plugins/bootstrap-table/bootstrap-table.js"></script>
<script src="${basePath}/assets/common/js/base.js"></script>
<script type="text/javascript">
	$(function(){
	orderForm = $("#order-form").form();
	orderSearchForm=$("#order-search-form").form();
	//-------------button event begin----------------
	$('button[data-btn-type]').click(function() {
		var selected = $('#order-table').bootstrapTable('getSelections');
		var action = $(this).attr('data-btn-type');
		switch (action) {
		case 'scan':
			if(selected.length != 1){
				layer.alert('请选择要编辑的数据,每次只能选一条!');
				return false;
			}
			resetForm();
			$("#modalOrderLabel").text("查看订单信息");
			$("#model-order").modal("toggle");
			$("#saveBtn").hide();
			$('#order-form').find('input,textarea,select').attr('readonly',true);
			orderForm.initFormData(selected[0]);
		   	break;
		case 'delete':
			if(selected.length < 1){
				layer.alert('请选择要删除的数据');
				return false;
			}
			layer.confirm("是否要删除该行数据？",function(){
				var rowIds = getIdSelections();
				ajaxPost(basePath + "/shopping/deleteOrder", {
					ids: JSON.stringify(rowIds)
				}, function(data){
					layer.msg(data.code, {
						icon : 1,
						time : 1500,
				});
					$('#order-table').bootstrapTable('remove', { field: 'id', values: rowIds});
				});
				return true;
			})
			break;
		case 'search':
			var formParams = $("#order-search-form").serializeJSON();
			ajaxGet(basePath + "/shopping/orderList", {
				params:JSON.stringify(formParams)
			}, function(data) {
				$('#order-table').bootstrapTable('load',data);
			});	
			break;
		case 'reset':
			orderSearchForm.clearForm();
			$('#order-table').bootstrapTable('refresh');
			break;
		}

	});
	//-------------button event end----------------
	
	//-------------Validator from begin----------------

	//-------------Validator from end----------------
	});
	
	function resetForm(){
		orderForm.clearForm();
		$("#order-form").data('bootstrapValidator').resetForm();
	}
	
	/*
	 * 得到所有选中行
	 */
	function getIdSelections() {
		return $.map($('#order-table').bootstrapTable('getSelections'), function(row) {
			return row.id;
		});
	}
	
	/*
	 *格式化
	 */
	function orderStatusFormatter(value, row, index) {
		if (value != undefined && value != null && $.trim(value) != '') {
			if(value == '0'){
				return '已提交';
			}else if(value=='1'){
				return '已支付';
			}else if(value=='2'){
				return '已验收';
			}else if(value=='3'){
				return '已发货';
			}else if(value=='4'){
				return '已收货';
			}
		}else{
			return value;
		}	
	}
	
</script>