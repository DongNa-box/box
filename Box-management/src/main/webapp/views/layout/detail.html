<!-- Content Header (Page header) -->
<section class="content-header">
	<h1>
		排版管理<small>Layout Management</small>
	</h1>
	<ol class="breadcrumb">
		<li><a href="${basePath}/main"><i class="fa fa-dashboard"></i> 首页</a></li>
		<li class="active">排版管理</li>
	</ol>
</section>

<!-- Main content -->
<section class="content">
		<div class="box box-primary">
	        <form id="layout-search-form" action="" class="form-horizontal" method="post">
	        <div class="box-body">
	          	<div class="col-sm-4">
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子名称</label>
						<div class="col-sm-8">
							<input id="search-boxName" name="search-boxName" type="text" class="form-control"
								placeholder="请输入盒子名称" maxlength="11">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子长</label>
						<div class="col-sm-8">
							<input id="search-boxLength" name="search-boxLength" type="text" class="form-control"
								placeholder="请输入盒子长" maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子宽</label>
						<div class="col-sm-8">
							<input id="search-boxWidth" name="search-boxWidth" type="text" class="form-control"
								placeholder="请输入盒子宽" maxlength="11">
						</div>
					</div>
				</div>
				
				<div class="col-sm-4">
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子高</label>
						<div class="col-sm-8">
							<input id="search-boxHeight" name="search-boxHeight" type="text" class="form-control"
								placeholder="请输入盒子高" maxlength="11">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">纸张长</label>
						<div class="col-sm-8">
							<input id="search-paperLength" name="search-paperLength" type="text" class="form-control"
								placeholder="请输入纸张长" maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">纸张宽</label>
						<div class="col-sm-8">
							<input id="search-paperWidth" name="search-paperWidth" type="text" class="form-control"
								placeholder="请输入纸张宽" maxlength="11">
						</div>
					</div>
				</div>
				
				<div class="col-sm-4">
				<div class="form-group">
						<label class="col-sm-4 control-label">X边值</label>
						<div class="col-sm-8">
							<input id="search-paperXValue" name="search-paperXValue" type="text" class="form-control"
								placeholder="请输入X边值" maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">X边个数</label>
						<div class="col-sm-8">
							<input id="search-xnumber" name="search-xnumber" type="text" class="form-control"
								placeholder="请输入x边个数" maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">Y边个数</label>
						<div class="col-sm-8">
							<input id="search-ynumber" name="search-ynumber" type="text" class="form-control"
								placeholder="请输入y边个数" maxlength="11">
						</div>
					</div>
				</div>
				
	        </div>
	        </form>
	        
	        <!-- /.box-body -->
	        <div class="box-footer">
	        	<div class="row">
	          	<div id="toolbar" class="btn-toolbar">
					<div class="btn-group pull-left">
 						<button type="button" data-btn-type="scan" class="btn btn-info"><i class="fa fa-search-plus"></i>查看</button>
				
					</div>
			
					<div class="btn-group pull-right">
						<button type="button" data-btn-type="search" class="btn btn-primary"><i class="fa fa-search"></i>查询</button>
						<button type="button" data-btn-type="reset" class="btn btn-default"><i class="fa fa-reply"></i>重置</button>
					</div>
				</div>
				</div>
				<div class="row">
					<table id="layout-table" data-toggle="table" data-url="layout/detailList" data-toolbar="#toolbar" data-pagination="true" data-search="false"
						data-striped="true" data-show-export="true" data-page-size="10" data-click-to-select="true">
						<thead>
							<tr>
								<th data-checkbox="true" class="select-checkbox"></th>
<!-- 								<th data-align="center" data-field="layoutId" data-sortable="true">排版ID</th>
 -->
								<th data-align="center" data-field="boxName" data-sortable="true" >盒子名称</th> 
								<th data-align="center" data-field="boxLength" data-sortable="true" >盒子长</th>
								<th data-align="center" data-field="boxWidth" data-sortable="true">盒子宽</th>
								<th data-align="center" data-field="boxHeight" data-sortable="true">盒子高</th>
								<th data-align="center" data-field="boxUnit" data-sortable="true" data-formatter="unitFormatter">盒子单位</th>
								<th data-align="center" data-field="paperLength" data-sortable="true">纸张长</th>
								<th data-align="center" data-field="paperWidth" data-sortable="true">纸张宽</th>
								<th data-align="center" data-field="paperUnit" data-sortable="true" data-formatter="unitFormatter">纸张单位</th>
								<th data-align="center" data-field="paperXValue" data-sortable="true">X值</th>
								<th data-align="center" data-field="xnumber" data-sortable="true">x边个数</th>
								<th data-align="center" data-field="ynumber" data-sortable="true">y边个数</th>
								<th data-align="center" data-field="pictureAddress" data-sortable="true">排版图片地址</th>
								<th data-align="center" data-field="dxfAddress" data-sortable="true">dxf文件地址</th>
								<th data-align="center" data-field="createby" data-sortable="true" >创建人</th>
								<th data-align="center" data-field="createtime" data-sortable="true" data-formatter="formatteryyyyMMddHHmmss">注册时间</th>
								
							</tr>
						</thead>
					</table>
				</div>
	        </div>
	        <!-- /.box-footer-->
      </div>
</section>

<!-- 编辑菜单的弹窗 -->
<div class="modal fade col-xs-12" id="modal-layout" aria-labelledby="modalLayoutLabel" aria-hidden="true">
	<div class="modal-dialog" style="width:800px">
		<div class="modal-content">
			<form class="form-horizontal" action="" id="layout-form" method="post">
				<input type="hidden" id="flag" name="flag">
				<input type="hidden" id="layoutId" name="layoutId">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">×</button>
					<h4 class="modal-title" id="modalLayoutLabel"></h4>
				</div>
				<div class="modal-body">
				<div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子名称<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="boxName" name="boxName" type="text" class="form-control"
								 maxlength="11">
						</div>
					</div> 
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子长<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="boxLength" name="boxLength" type="text" class="form-control"
								 maxlength="11">

						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子宽<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="boxWidth" name="boxWidth" type="text" class="form-control"
								 maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子高<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="boxHeight" name="boxHeight" type="text" class="form-control"
								 maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">盒子单位<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<select name="boxUnit" id="boxUnit" class="form-control">
								<option value="">请选择...</option>
								<option value="0">mm</option>
								<option value="1">cm</option>
								<option value="2">dm</option>
								<option value="3">m</option>
							</select>
						</div>
					</div>
					</div>
					<div class="col-sm-6">
					<div class="form-group">
						<label class="col-sm-4 control-label">纸张长<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="paperLength" name="paperLength" type="text" class="form-control"
								maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">纸张宽<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="paperWidth" name="paperWidth" type="text" class="form-control"
								maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">纸张单位<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<select name="paperUnit" id="paperUnit" class="form-control">
								<option value="">请选择...</option>
								<option value="0">mm</option>
								<option value="1">cm</option>
								<option value="2">dm</option>
								<option value="3">m</option>
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">X边的值<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="paperXValue" name="paperXValue" type="text" class="form-control"
								maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">x边个数<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="xnumber" name="xnumber" type="text" class="form-control"
								maxlength="11">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">y边个数<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="ynumber" name="ynumber" type="text" class="form-control"
								maxlength="11">
						</div>
					</div>
					</div>
					
					 <div class="row">
		                   <label for="" class="col-sm-4 control-label"  >排版图片</label>
					  </div>
		              <div class="row">
		                  <div class="form-group">
		                         <input id="file-1" type="file" name="file-1"  class="file" data-overwrite-initial="false" data-min-file-count="1">
		                  </div>
					  </div>
					
					<!-- <div class="form-group">
						<label class="col-sm-4 control-label">排版图片地址<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="pictureAddress" name="pictureAddress" type="text" class="form-control"
								maxlength="11">
						</div>
					</div> -->
					  <div class="row">
		                <label for="" class="col-sm-4 control-label"  >DXF排版文件</label>

				  </div>
	              <div class="row">
	                  <div class="form-group" >
	                       <input id="file-2" type="file" name="file-2" class="file" data-overwrite-initial="false" data-min-file-count="1" >
	                  </div>
				  </div>
					<!-- <div class="form-group" style="display:none">
						<label class="col-sm-4 control-label">dxf文件地址<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="dxfAddress" name="dxfAddress" type="text" class="form-control"
								maxlength="11">
						</div>
					</div> -->
					
					<div class="modal-footer">
						<button type="submit" class="btn btn-success" id="saveBtn"><i class="fa fa-save"></i>保存</button>
						<button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i>关闭</button>
					</div>
				
				
			</form>
		</div>
	</div>
</div>
<script src="${basePath}/assets/adminlte/plugins/bootstrap-table/bootstrap-table.js"></script>
<script src="${basePath}/assets/common/js/base.js"></script>
<script type="text/javascript">
	$(function(){
	layoutForm = $("#layout-form").form();
	layoutSearchForm=$("#layout-search-form").form();
	//-------------button event begin----------------
	$('button[data-btn-type]').click(function() {
		var selected = $('#layout-table').bootstrapTable('getSelections');
		var action = $(this).attr('data-btn-type');
		switch (action) {
		case 'scan':
			if(selected.length != 1){
				layer.alert('请选择要编辑的数据,每次只能选一条!');
				return false;
			}
			resetForm();
			$("#modalLayoutLabel").text("查看排版信息");
			$("#modal-layout").modal("toggle");
			$("#saveBtn").hide();
			$('#layout-form').find('input,textarea,select').attr('readonly',true);
			formEdit(selected[0]);
			
		   	break;
		case 'search':
			var formParams = $("#layout-search-form").serializeJSON();
			ajaxGet(basePath + "/layout/detailList", {
				params:JSON.stringify(formParams)
			}, function(data) {
				$('#layout-table').bootstrapTable('load',data);
			});	
			break;
		case 'reset':
			layoutSearchForm.clearForm();
			$('#layout-table').bootstrapTable('refresh');
			break;
		}

	});
	//-------------button event end----------------
	});

	function resetForm(){
		layoutForm.clearForm();
		//$("#layout-form").data('bootstrapValidator').resetForm();
	}
	
	/*
	 * 得到所有选中行
	 */
	function getIdSelections() {
		return $.map($('#layout-table').bootstrapTable('getSelections'), function(row) {
			return row.id;
		});
	}
	/*单位格式化
	*/
	function unitFormatter(value, row, index) {
		if (value != undefined && value != null && $.trim(value) != '') {
			if(value == '0'){
				return 'mm';
			}else if(value=='1'){
				return 'cm';
			}else if(value=='2'){
				return 'dm';
			}else if(value=='3'){
				return 'm';
			}
		}else{
			return value;
		}	
	}
	//查看纸盒时回传数据
	function formEdit(data) {
		layoutForm.initFormData(data);
	    console.log(data);
	    pictureAddress=data.pictureAddress;
	    dxfAddress=data.dxfAddress;
		orlist=new Array();//图片地址集合
		titlelist=new Array();//图片名称集合
		var t=new Object();
		t.width="120px";
    	t.key=0;
		    	    var path="images/LayoutDetail/"+data.layoutId;
		    	    orlist[0]=path+"/previewimageaddress/"+pictureAddress;
		        	t.caption=pictureAddress;
		            titlelist[0]=t;	
		            setScanFileStyle('file-1',orlist,titlelist,pictureAddress);
		           
		            orlist[0]=path+"/dxf/"+dxfAddress;
		        	t.caption=dxfAddress;
		            titlelist[0]=t;	
		            $("#file-2").fileinput({
		    			language: 'zh', //设置语言
		    		    uploadUrl: '#', // you must set a valid URL here else you will get an error
		    		    showRemove: false,
		    		    showBrowse:false,
		    		    overwriteInitial: false,
		    		    showUpload:false,
		    		    showPreview:false,
		    		    dropZoneEnabled: false,//是否显示拖拽区域
		    		    maxFileCount: 1,
		    		    minFileCount: 1,
		    		    layoutTemplates:{
		    		    	actionDelete:'',
		    		    	actionUpload:'',
		    		    },
		    		    initialPreview:orlist,
		    		    initialPreviewAsData: true,
		    	        initialPreviewConfig: titlelist,
		    		    slugCallback: function (dxf) {
		    		        return dxf.replace('(', '_').replace(']', '_');
		    		    },
		    		});

	}
	function setScanFileStyle(fileId,orlist,titlelist,filename){
	    $("#"+fileId).fileinput({
			language: 'zh', //设置语言
		    uploadUrl: '#', // you must set a valid URL here else you will get an error
		    showRemove: false,
		    overwriteInitial: false,
		    showBrowse:false,
		    showUpload:false,
		    maxFileCount: 1,
		    minFileCount: 1,
		    layoutTemplates:{
		    	actionDelete:'',
		    	actionUpload:'',
		    },
		    initialPreview:orlist,
		    initialPreviewAsData: true,
	        initialPreviewConfig: titlelist,
		    slugCallback: function (filename) {
		        return filename.replace('(', '_').replace(']', '_');
		    },
		});
	}
</script>