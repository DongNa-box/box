<!-- Main content -->
<section class="content">
<!--  
	<div class="container-fluid">
-->		
		<div class="box box-primary">
	        <form id="appuser-search-form" action="" class="form-horizontal" method="post">
	        <div class="box-body">
	          	<div class="col-sm-4">
					<div class="form-group">
						<label class="col-sm-4 control-label">用户名</label>
						<div class="col-sm-8">
							<input id="search-loginName" name="search-loginName" type="text" class="form-control"
								placeholder="请输入用户名">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">手机号码</label>
						<div class="col-sm-8">
							<input id="search-phone" name="search-phone" type="text" class="form-control"
								placeholder="请输入手机号码" maxlength="11">
						</div>
					</div>
				</div>
				
				<div class="col-sm-4">
				
					<div class="form-group">
						<label class="col-sm-4 control-label">真实姓名</label>
						<div class="col-sm-8">
							<input id="search-name" name="search-name" type="text" class="form-control"
								placeholder="请输入真实姓名">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">状态</label>
						<div class="col-sm-8">
							<select name="search-status" id="search-status" class="form-control">
								<option value="">请选择...</option>
								<option value="1">启用</option>
								<option value="0">禁用</option>
							</select>
						</div>
					</div>			
				</div>
	        </div>
	        </form>
	        
	        <!-- /.box-body -->
	        <div class="box-footer">
	        	<div class="row">
	          	<div id="toolbar" class="btn-toolbar">
					<div class="btn-group pull-left">
						<button type="button" data-btn-type="add" class="btn btn-success"><i class="fa fa-plus"></i>新增</button>
						  
						<button type="button" data-btn-type="scan" class="btn btn-info"><i class="fa fa-search-plus"></i>查看</button>
						<button type="button" data-btn-type="edit" class="btn btn-warning"><i class="fa fa-edit"></i>修改</button>
						<button type="button" data-btn-type="delete" class="btn btn-danger"><i class="fa fa-remove"></i>删除</button>
					</div>

					<div class="btn-group pull-left">
						<button type="button" data-btn-type="enable" class="btn btn-success"><i class="fa fa-check-circle-o"></i>启用</button>
						<button type="button" data-btn-type="disable" class="btn btn-danger"><i class="fa fa-ban"></i>禁用</button>
					</div>					
					<div class="btn-group pull-right">
						<button type="button" data-btn-type="search" class="btn btn-primary"><i class="fa fa-search"></i>查询</button>
						<button type="button" data-btn-type="reset" class="btn btn-default"><i class="fa fa-reply"></i>重置</button>
					</div>
				</div>
				</div>
				<div class="row">
					<table id="appuser-table" data-toggle="table" data-url="uums/appUserList" data-toolbar="#toolbar" data-pagination="true" data-search="false"
						data-striped="true" data-show-export="true" data-page-size="10" data-click-to-select="true">
						<thead>
							<tr>
								<th data-checkbox="true" class="select-checkbox"></th>
							<!-- 	<th data-align="center" data-field="id" data-sortable="true">用户ID</th> -->
								<th data-align="center" data-field="loginName" data-sortable="true">用户名</th>
								<th data-align="center" data-field="name" data-sortable="true">真实姓名</th>
								<th data-align="center" data-field="phone" data-sortable="true">手机号码</th>
								<th data-align="center" data-field="sex" data-sortable="true" data-formatter="sexFormatter">性别</th>
								<th data-align="center" data-field="birthday" data-sortable="true" data-formatter="formatteryyyyMMdd">出生日期</th>
								<th data-align="center" data-field="createTime" data-sortable="true" data-formatter="formatteryyyyMMddHHmmss">注册时间</th>
								<th data-align="center" data-field="lastLoginTime" data-sortable="true" data-formatter="formatteryyyyMMddHHmmss">最近登陆时间</th>
								<th data-align="center" data-field="loginCount" data-sortable="true">登陆次数</th>
								<th data-align="center" data-field="type" data-sortable="true" data-formatter="userTypeFormatter">用户类别</th>
								<th data-align="center" data-field="status" data-sortable="true" data-formatter="operateFormatter">是否启用</th>
							</tr>
						</thead>
					</table>
				</div>
	        </div>
	        <!-- /.box-footer-->
      </div>
    <!--  
	</div>
	-->
</section>

<!-- 新增用户的弹窗 -->
<div class="modal fade" id="modal-appuser" aria-labelledby="modalAppUserLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form class="form-horizontal" action="" id="appuser-form" method="post">
				<input type="hidden" id="flag" name="flag">
				<input type="hidden" id="id" name="id">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">×</button>
					<h4 class="modal-title" id="modalAppUserLabel"></h4>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label class="col-sm-4 control-label">用户名<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="loginName" name="loginName" type="text" class="form-control"
								placeholder="请输入用户名">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">手机号码<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="phone" name="phone" type="text" class="form-control"
								placeholder="请输入手机号码" maxlength="11">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">真实姓名<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<input id="name" name="name" type="text" class="form-control"
								placeholder="请输入真实姓名">
						</div>
					</div>

					<div class="form-group">
						<label class="col-sm-4 control-label">出生日期<span style="color: red;">*</span></label>
						<div class="input-group date col-sm-8">
							<div class="input-group-addon">
	                        	<i class="fa fa-calendar"></i>
	                        </div>
							<input id="birthday" name="birthday" type="text" class="form-control" id="birthday" data-flag="datepicker" data-format="yyyy-MM-dd"
								placeholder="请选择出生日期">

						</div>
					</div>

					<div class="form-group">
						<label class="col-sm-4 control-label">性别<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<select name="sex" id="sex" class="form-control">
								<option value="">请选择...</option>
								<option value="1">男</option>
								<option value="2">女</option>
							</select>
						</div>
					</div>

					<div class="form-group">
						<label class="col-sm-4 control-label">状态<span style="color: red;">*</span></label>
						<div class="col-sm-8">
							<label class="control-label"> <input type="radio"
								name="status" data-flag="icheck" value="1" checked="checked">
								启用
							</label> &nbsp; <label class="control-label"> <input type="radio"
								name="status" data-flag="icheck" value="0">
								禁用
							</label>
						</div>
					</div>
					
					<div class="modal-footer">
						<button type="submit" class="btn btn-success" id="saveBtn"><i class="fa fa-save"></i>保存</button>
						<button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i>关闭</button>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>

<script src="${basePath}/assets/adminlte/plugins/bootstrap-table/bootstrap-table.js"></script>
<script src="${basePath}/assets/common/js/base.js"></script>
<script type="text/javascript">
$(function(){
	userForm = $("#appuser-form").form();
	userSearchForm = $("#appuser-search-form").form();
	//-------------button event begin----------------
	$('button[data-btn-type]').click(function() {
		var selected = $('#appuser-table').bootstrapTable('getSelections');
		var action = $(this).attr('data-btn-type');
		switch (action) {
		case 'add':
			resetForm();
			$("#flag").val("03");
			
			$("#modalAppUserLabel").text("新增app用户");
			$('#modal-appuser').modal('toggle');
			$("#saveBtn").show();
			$('#appuser-form').find('input,textarea,select').attr('readonly',false);
			break;
		case 'scan':
			if(selected.length != 1){
				layer.alert('请选择要编辑的数据,每次只能选一条!');
				return false;
			}
			resetForm();
			$("#modalAppUserLabel").text("查看用户信息");
			$("#model-appuser").modal("toggle");
			$("#saveBtn").hide();
			$('#appuser-form').find('input,textarea,select').attr('readonly',true);
			userForm.initFormData(selected[0]);
		   	break;
		case 'edit':
			if(selected.length != 1){
				layer.alert('请选择要编辑的数据,每次只能选一条!');
				return false;
			}
			resetForm();
			$("#flag").val("2");
			$("#modalAppUserLabel").text("编辑app用户");
			$("#modal-appuser").modal("toggle");
			userForm.initFormData(selected[0]);
			$("#saveBtn").show();
			$('#appuser-form').find('input,textarea,select').attr('readonly',false);
			$("#loginName").attr("disabled","disabled");//将loginName input元素设置为disabled 
			$("#phone").attr("disabled","disabled");//将phone input元素设置为disabled 
		   	break;
		case 'delete':
			if(selected.length < 1){
				layer.alert('请选择要删除的数据');
				return false;
			}
			layer.confirm("是否要删除该行数据？",function(){
				var rowIds = getIdSelections();
				ajaxPost(basePath + "/uums/deleteAdmin", {
					uids:JSON.stringify(rowIds)
				}, function(data){
					layer.msg(data.code, {
						icon : 1,
						time : 1500,
				});
					$('#appuser-table').bootstrapTable('remove', { field: 'id', values: rowIds});
				});
				return true;
			})
			break;
		case 'search':
			var formParams = $("#appuser-search-form").serializeJSON();
			ajaxGet(basePath + "/uums/appUserList", {
				params:JSON.stringify(formParams)
			}, function(data) {
				$('#appuser-table').bootstrapTable('load',data);
			});	
			break;
		case 'reset':
			userSearchForm.clearForm();
			$('#appuser-table').bootstrapTable('refresh');
			break;
		case 'enable':
			if(selected.length != 1){
				layer.alert('请选择要启用的用户,每次只能选一条!');
				return false;
			}
			if(selected[0].status == '1'){
				layer.alert('已是启用状态!');
				return false;
			}else{
				var params = {};
				params['id'] = selected[0].id;
				params['status'] = 1;
				ajaxPost(basePath + "/uums/updateStatus", {
	        		params:JSON.stringify(params)
				},  function(data){
					$('#modal-appuser').modal('hide');
					layer.msg(data.code, {
						icon : 1,
						time : 1500,
					});
					$('#appuser-table').bootstrapTable('refresh');
	        	});
			}
			break;
		case 'disable':
			if(selected.length != 1){
				layer.alert('请选择要禁用的用户,每次只能选一条!');
				return false;
			}
			if(selected[0].status == '0'){
				layer.alert('已是禁用状态!');
				return false;
			}
			if(selected[0].type == 2){
				layer.alert('管理员不可被禁用');
				return false;
			}else{
				var params = {};
				params['id'] = selected[0].id;
				params['status'] = 0;
				ajaxPost(basePath + "/uums/updateStatus", {
	        		params:JSON.stringify(params)
				},  function(data){
					$('#modal-appuser').modal('hide');
					layer.msg(data.code, {
						icon : 1,
						time : 1500,
					});
					$('#appuser-table').bootstrapTable('refresh');
	        	});
			}
			break;
		
		}

	});
	//-------------button event end----------------
	
	//-------------Validator from begin----------------
	$("#appuser-form").bootstrapValidator({
		message : '请输入有效值',
		feedbackIcons : {
			valid : 'glyphicon glyphicon-ok',
			invalid : 'glyphicon glyphicon-remove',
			validating : 'glyphicon glyphicon-refresh'
		},
		fields : {
			loginName : {
				validators : {
					notEmpty : {
						message : '请输入用户名'
					},
					threshold : 10,
					remote : {
						url : basePath + "/uums/checkLoginNameExists",
						message : '用户名已存在',
						delay : 2000,
						type : 'POST'
					}
				}
			},
			sex : {
				validators : {
					notEmpty : {
						message : '请选择性别'
					}
				}
			},
			birthday : {
				validators : {
					notEmpty : {
						message : '请输入出生日期'
					},
					date : {
						format : 'YYYY-MM-DD',
						message : '请输入有效日期'
					} 
				}
			},
			name : {
				validators : {
					notEmpty : {
						message : '请输入真实姓名'
					}
				}
			},
			phone : {
				validators : {
					notEmpty : {
						message : '请输入手机号码'
					},
					integer : {
						message : '请输入数字'
					},
					integer : {
						message : '请输入数字'
					},
					stringLength: {
                        min: 11,
                        max: 12,
                        message: '固定号码长度应该为11位'
                    }, 
                   /*  regexp: {
                        regexp: /^(?:13\d|15[89])-?\d{5}(\d{3}|\*{3})$/,
                        message: '请输入正确的11位手机号码'
                    }, */
					threshold : 11,
					remote : {
						url : basePath + "/uums/checkPhoneExists",
						message : '手机号码已存在',
						delay : 2000,
						type : 'POST'
					}
				}
			},
			type : {
				validators : {
					notEmpty : {
						message : '请选择用户类别'
					}
				}
			},
			status : {
				validators : {
					notEmpty : {
						message : '请选择状态'
					}
				}				
			}
		},

        submitHandler: function (validator, form, submitButton) {
        	var formParams = form.serializeJSON();
        	
        	formParams.flag=$("#flag").val();
        	ajaxPost(basePath + "/uums/editUser", {
        		params:JSON.stringify(formParams)
			},  function(data){
				$('#modal-appuser').modal('hide');
				layer.msg(data.code, {
					icon : 1,
					time : 1500,
				});
				$('#appuser-table').bootstrapTable('refresh');
        	});
        }
	});
	//-------------Validator from end----------------
});

	
	function resetForm(){
		userForm.clearForm();
		$("#appuser-form").data('bootstrapValidator').resetForm();
	}
	
	/*
	 * 得到所有选中行
	 */
	function getIdSelections() {
		return $.map($('#appuser-table').bootstrapTable('getSelections'),function(row) {
				return row.id;
		});
	}
</script>